<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Snake Arena Live</title>
    <style>
        body { background: #000; color: #0f0; font-family: sans-serif; text-align: center; }
        canvas { border: 2px solid #333; background: #111; margin-top: 20px; }
    </style>
</head>
<body>
    <h1 id="status">Connecting...</h1>
    <canvas id="arena" width="800" height="800"></canvas>
    
    <script>
        const canvas = document.getElementById('arena');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status');
        
        function connect() {
            const ws = new WebSocket(`ws://${location.host}`);
            
            ws.onopen = () => { status.innerText = "LIVE: Connected"; status.style.color = "#0f0"; };
            ws.onclose = () => { status.innerText = "Disconnected"; status.style.color = "#f00"; setTimeout(connect, 1000); };
            
            ws.onmessage = (e) => {
                try {
                    const msg = JSON.parse(e.data);
                    if (msg.type === 'update') {
                        draw(msg.state);
                    }
                } catch(err) { console.error(err); }
            };
        }

        function draw(state) {
            // 1. Clear
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 2. Draw Turn Counter (Background)
            ctx.fillStyle = '#222';
            ctx.font = 'bold 200px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(state.turn, 400, 400);

            // 3. Draw Grid
            const TILE = canvas.width / state.gridSize;

            // 4. Draw Food
            ctx.fillStyle = '#f00';
            state.food.forEach(f => {
                ctx.beginPath();
                ctx.arc(f.x*TILE + TILE/2, f.y*TILE + TILE/2, TILE/2-2, 0, Math.PI*2);
                ctx.fill();
            });

            // 5. Draw Players
            state.players.forEach(p => {
                ctx.fillStyle = p.color;
                p.body.forEach(b => {
                    ctx.fillRect(b.x*TILE+1, b.y*TILE+1, TILE-2, TILE-2);
                });
                
                // Name tag
                const head = p.body[0];
                ctx.fillStyle = '#fff';
                ctx.font = '10px Arial';
                ctx.fillText(p.name, head.x*TILE + TILE/2, head.y*TILE - 5);
            });
            
            status.innerText = `Turn: ${state.turn} | Players: ${state.players.length}`;
        }

        connect();
    </script>
</body>
</html>